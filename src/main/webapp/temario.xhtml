<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	template="/template/menuFijo.xhtml">

	<f:metadata>
		<f:event type="preRenderView" listener="#{loginBean.checkAccess()}" />
		<f:event type="preRenderView"
			listener="#{temarioBean.cargarTemarios()}" />
	</f:metadata>

	<ui:define name="content">

		<p:messages id="messages" showDetail="true" closable="true" />
		<p:growl id="growl" showDetail="true" life="4000" />

		<h:form id="formTemario">
			<div class="card content-card"
				style="position: fixed; top: 10px; left: 300px; width: 1200px; height: 770px; overflow-y: auto;">
				<!--         <div class="card content-card" style="position: fixed; top: 10px; left: 280px; right: 20px; bottom: 20px; overflow-y: auto; margin: 0; padding: 20px;"> -->

				<h2 style="margin-top: 0; color: var(--card-text);">Biblioteca
					de Temarios</h2>

				<p:dataTable var="temario" value="#{temarioBean.temarios}"
					filteredValue="#{temarioBean.filteredTemarios}"
					widgetVar="temariosTable"
					emptyMessage="No hay temarios disponibles" lazy="false"
					paginator="true" rows="10" styleClass="temario-table">

					<f:facet name="header">
						<div class="flex align-items-center justify-content-between">
							<!--                         <span>Temarios disponibles</span> -->
							<div>
								<p:commandButton value="Crear Temario"
									rendered="#{temarioBean.puedeEditar()}"
									styleClass="ui-button-success"
									onclick="PF('dlgNuevoTemario').show(); return false;"
									style="padding: 10px 20px;" />
							</div>
						</div>
					</f:facet>

					<f:facet name="footer">
						<div class="flex align-items-center justify-content-center">
							<span>Total Temarios: #{temarioBean.temarios.size()}</span>
						</div>
					</f:facet>

					<p:column headerText="#" filterable="false"
						style="width: 60px; text-align: center;">
						<h:outputText value="#{temario.id}" style="font-weight: bold;" />
					</p:column>

					<p:column headerText="Tema/Algoritmo" filterable="true"
						filterBy="#{temario.temaAlgoritmo}">
						<div style="display: flex; align-items: center;">
							<i class="pi pi-code"
								style="color: #3498db; margin-right: 10px; font-size: 16px;"></i>
							<div>
								<h:outputText value="#{temario.temaAlgoritmo}"
									style="font-weight: bold; font-size: 16px;" />
								<br />
								<h:outputText value="#{temario.contenido}"
									style="font-size: 12px; opacity: 0.8;"
									rendered="#{not empty temario.contenido}" />
							</div>
						</div>
					</p:column>

					<p:column headerText="Tipo" filterable="true"
						filterBy="#{temario.tipo}" style="width: 150px;">
						<span class="ui-tag ui-tag-rounded"
							style="background-color: #{temario.tipo eq 'Algoritmo' ? '#e74c3c' : 
                                                    temario.tipo eq 'Grafos' ? '#9b59b6' : 
                                                    temario.tipo eq 'DP' ? '#f39c12' : 
                                                    temario.tipo eq 'Estructura de Datos' ? '#27ae60' : 
                                                    temario.tipo eq 'Búsquedas' ? '#3498db' : '#34495e'}; 
                                 color: white; padding: 5px 12px; font-size: 11px; font-weight: bold;">
							#{temario.tipo} </span>
					</p:column>

					<p:column headerText="Código"
						style="width: 100px; text-align: center;">
						<h:panelGroup rendered="#{not empty temario.codigo}">
							<i class="pi pi-check-circle"
								style="color: #27ae60; font-size: 20px;"
								title="Código disponible"></i>
						</h:panelGroup>
						<h:panelGroup rendered="#{empty temario.codigo}">
							<i class="pi pi-times-circle"
								style="color: #e74c3c; font-size: 20px;" title="Sin código"></i>
						</h:panelGroup>
					</p:column>

					<p:column headerText="Acciones"
						style="width: 120px; text-align: center;">
						<p:commandButton icon="pi pi-trash"
							rendered="#{temarioBean.puedeEditar()}"
							styleClass="ui-button-danger ui-button-sm"
							action="#{temarioBean.eliminarPorId(temario.id)}"
							update="formTemario messages growl"
							onclick="return confirm('¿Eliminar el temario \'#{temario.temaAlgoritmo}\'?');"
							title="Eliminar temario" />
					</p:column>
				</p:dataTable>
			</div>
		</h:form>

		<p:dialog header="Nuevo temario" widgetVar="dlgNuevoTemario"
			width="500" height="400" modal="false" dismissible="false"
			blockScroll="false" closeOnEscape="false" resizable="false"
			closable="true" styleClass="temario-dialog">

			<h:form id="formNuevoTemario">
				<h:panelGrid columns="2" cellpadding="10" style="width: 100%;">

					<h:outputLabel for="tema" value="Tema/Algoritmo:"
						style="font-weight: bold;" />
					<h:inputText id="tema" value="#{temarioBean.temaAlgoritmo}"
						required="true" style="width: 250px; padding: 8px;" />

					<h:outputLabel for="tipo" value="Tipo:" style="font-weight: bold;" />
					<p:selectOneMenu id="tipo" value="#{temarioBean.tipo}"
						style="width: 250px;">
						<f:selectItem itemLabel="Selecciona tipo..." itemValue="" />
						<f:selectItems value="#{temarioBean.tipos}" />
					</p:selectOneMenu>

					<h:outputLabel for="contenido" value="Descripción:"
						style="font-weight: bold;" />
					<h:inputTextarea id="contenido" value="#{temarioBean.contenido}"
						rows="4" style="width: 250px; padding: 8px;" />

					<h:outputLabel for="codigo" value="Código:"
						style="font-weight: bold;" />
					<h:inputTextarea id="codigo" value="#{temarioBean.codigo}" rows="5"
						style="width: 250px; padding: 8px; font-family: 'Courier New', monospace;" />
				</h:panelGrid>

				<p:separator />

				<div style="text-align: center; padding-top: 15px;">
					<p:commandButton value="Guardar"
						action="#{temarioBean.crearTemario}"
						update="formTemario formNuevoTemario messages growl"
						oncomplete="PF('dlgNuevoTemario').hide();"
						styleClass="ui-button-success"
						style="margin-right: 10px; padding: 10px 20px;" />

					<p:commandButton value="Cancelar" type="button"
						onclick="PF('dlgNuevoTemario').hide();"
						styleClass="ui-button-secondary" style="padding: 10px 20px;" />
				</div>
			</h:form>
		</p:dialog>

	</ui:define>
</ui:composition>