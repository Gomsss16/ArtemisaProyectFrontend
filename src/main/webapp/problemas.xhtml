<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	template="/template/menuFijo.xhtml">


	<f:metadata>
		<f:event type="preRenderView" listener="#{loginBean.checkAccess()}" />
		<f:event type="preRenderView"
			listener="#{problemaBean.cargarProblema()}" />
	</f:metadata>

	<ui:define name="content">

		<p:messages id="messages" showDetail="true" closable="true" />
		<p:growl id="growl" showDetail="true" life="4000" />

		<h:form id="formProblema">
			<!--         <div class="card content-card" style="position: fixed; top: 10px; left: 320px; right: 20px; bottom: 20px; overflow-y: auto; margin: 0; padding: 20px;"> -->
			<!--         <div class="card content-card" style="position: fixed; top: 10px; left: 280px; right: 20px; bottom: 20px; overflow-y: auto; margin: 0; padding: 20px;"> -->
			<div class="card content-card"
				style="position: fixed; top: 10px; left: 300px; width: 1200px; height: 770px; overflow-y: auto;">


				<h2 style="margin-top: 0; color: var(--card-text);">Biblioteca
					de Problemas</h2>

				<p:dataTable var="problema" value="#{problemaBean.problemas}"
					filteredValue="#{problemaBean.filteredProblemas}"
					widgetVar="problemasTable"
					emptyMessage="No hay problemas disponibles" lazy="false"
					paginator="true" rows="15" styleClass="problema-table"
					style="margin-top: 20px;">

					<f:facet name="header">
						<div class="flex align-items-center justify-content-between">
							<span></span>
							<div>
								<p:commandButton value="Crear Problema"
									rendered="#{eventoBean.puedeEditar()}"
									styleClass="ui-button-success"
									onclick="PF('dlgNuevoProblema').show(); return false;"
									style="padding: 10px 20px;" />
							</div>
						</div>
					</f:facet>

					<f:facet name="footer">
						<div class="flex align-items-center justify-content-center">
							<span>Total Problemas: #{problemaBean.problemas.size()}</span>
						</div>
					</f:facet>

					<p:column headerText="ID" filterable="false"
						style="width: 60px; text-align: center;">
						<h:outputText value="#{problema.id}" style="font-weight: bold;" />
					</p:column>

					<p:column headerText="Título" filterable="true"
						filterBy="#{problema.titulo}">
						<div style="display: flex; align-items: center;">
							<i class="pi pi-file-edit"
								style="color: #e74c3c; margin-right: 10px; font-size: 16px;"></i>
							<div>
								<h:outputText value="#{problema.titulo}"
									style="font-weight: bold; font-size: 16px;" />
								<br />
								<h:outputText value="#{problema.tema}"
									style="font-size: 12px; opacity: 0.8;"
									rendered="#{not empty problema.tema}" />
							</div>
						</div>
					</p:column>

					<p:column headerText="Dificultad" filterable="true"
						filterBy="#{problema.dificultad}"
						style="width: 120px; text-align: center;">
						<span class="ui-tag ui-tag-rounded"
							style="background-color: #{problema.dificultad le 3 ? '#27ae60' : 
                                                    problema.dificultad le 7 ? '#f39c12' : 
                                                    problema.dificultad le 10 ? '#e67e22' : '#e74c3c'}; 
                                 color: white; padding: 5px 12px; font-size: 11px; font-weight: bold;">
							#{problema.dificultad}/15 </span>
					</p:column>

					<p:column headerText="Juez" filterable="true"
						filterBy="#{problema.juez}" style="width: 120px;">
						<span class="ui-tag ui-tag-rounded"
							style="background-color: #{problema.juez eq 'Codeforces' ? '#1f8dd6' : 
                                                    problema.juez eq 'AtCoder' ? '#3498db' : 
                                                    problema.juez eq 'LeetCode' ? '#f39c12' : '#34495e'}; 
                                 color: white; padding: 5px 8px; font-size: 10px; font-weight: bold;">
							#{problema.juez} </span>
					</p:column>

					<p:column headerText="Ir" style="width: 80px; text-align: center;">
						<h:panelGroup rendered="#{not empty problema.link}">
							<p:commandButton icon="pi pi-external-link"
								styleClass="ui-button-info ui-button-sm"
								onclick="window.open('#{problema.link}', '_blank'); return false;"
								title="Ir al problema" />
						</h:panelGroup>
						<h:panelGroup rendered="#{empty problema.link}">
							<i class="pi pi-times-circle"
								style="color: #e74c3c; font-size: 16px;" title="Sin link"></i>
						</h:panelGroup>
					</p:column>

					<p:column headerText="Acciones"
						style="width: 100px; text-align: center;">
						<p:commandButton icon="pi pi-trash"
							rendered="#{eventoBean.puedeEditar()}"
							styleClass="ui-button-danger ui-button-sm"
							action="#{problemaBean.eliminarPorId(problema.id)}"
							update="formProblema messages growl"
							onclick="return confirm('¿Eliminar el problema \'#{problema.titulo}\'?');"
							title="Eliminar problema" />
					</p:column>
				</p:dataTable>
			</div>
		</h:form>

		<p:dialog header="Nuevo problema" widgetVar="dlgNuevoProblema"
			width="500" height="450" modal="false" dismissible="false"
			blockScroll="false" closeOnEscape="false" resizable="false"
			closable="true" styleClass="problema-dialog">

			<h:form id="formNuevoProblema">
				<h:panelGrid columns="2" cellpadding="10" style="width: 100%;">

					<h:outputLabel for="titulo" value="Título:"
						style="font-weight: bold;" />
					<h:inputText id="titulo" value="#{problemaBean.titulo}"
						required="true" style="width: 250px; padding: 8px;" />

					<h:outputLabel for="dificultad" value="Dificultad (1-15):"
						style="font-weight: bold;" />
					<p:inputNumber id="dificultad" value="#{problemaBean.dificultad}"
						minValue="1" maxValue="15" style="width: 250px;" />

					<h:outputLabel for="tema" value="Tema:" style="font-weight: bold;" />
					<h:inputText id="tema" value="#{problemaBean.tema}" required="true"
						style="width: 250px; padding: 8px;" />

					<h:outputLabel for="juez" value="Juez:" style="font-weight: bold;" />
					<p:selectOneMenu id="juez" value="#{problemaBean.juez}"
						style="width: 250px;">
						<f:selectItem itemLabel="Selecciona juez..." itemValue="" />
						<f:selectItems value="#{problemaBean.jueces}" />
					</p:selectOneMenu>

					<h:outputLabel for="link" value="Link:" style="font-weight: bold;" />
					<h:inputText id="link" value="#{problemaBean.link}"
						style="width: 250px; padding: 8px;" />
				</h:panelGrid>

				<p:separator />

				<div style="text-align: center; padding-top: 15px;">
					<p:commandButton value="Guardar"
						action="#{problemaBean.crearProblema}" update="formProblema growl"
						styleClass="ui-button-success"
						style="margin-right: 10px; padding: 10px 20px;" />

					<p:commandButton value="Cancelar" type="button"
						onclick="PF('dlgNuevoProblema').hide();"
						styleClass="ui-button-secondary" style="padding: 10px 20px;" />
				</div>
			</h:form>
		</p:dialog>

	</ui:define>
</ui:composition>
