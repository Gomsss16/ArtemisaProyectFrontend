<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui" template="/template/menuFijo.xhtml">

	<f:metadata>
		<f:event type="preRenderView" listener="#{loginBean.checkAccess()}" />
		<f:event type="preRenderView" listener="#{libroBean.cargarLibro()}" />
	</f:metadata>

	<ui:define name="head">
		<h:outputStylesheet library="css" name="estilos.css" />
	</ui:define>

	<ui:define name="content">

		<p:messages id="messages" showDetail="true" closable="true" />
		<p:growl id="growl" showDetail="true" life="4000" />

		<h:form id="formLibro">
<!-- 			<div class="card content-card" style="position: fixed; top: 10px; left: 280px; right: 20px; bottom: 20px; overflow-y: auto; margin: 0; padding: 20px;"> -->
			<div class="card content-card" style="position: fixed; top: 10px; left: 300px; width: 1200px; height: 770px; overflow-y: auto;">
			
				<h2 style="margin-top: 0; color: var(--card-text);">Biblioteca
					de Libros</h2>

				<p:commandButton styleClass="rounded-button" value="Cargar libro"
					style="background-color:#007ad9; color:#fff; border:none; z-index:9999; margin-bottom: 20px; padding: 10px 20px;"
					icon="pi pi-plus" onclick="PF('aniadirLibro').show();"
					rendered="#{!libroBean.esEstudiante()}" type="button" />

				<p:dataList id="bookList" value="#{libroBean.books}" var="libro"
					layout="grid" columns="3" emptyMessage="No hay libros disponibles"
					style="margin-top: 20px;">

					<f:facet name="header">
						<div class="flex align-items-center justify-content-center">
							<span>Libros disponibles: #{libroBean.books.size()}</span>
						</div>
					</f:facet>

					<p:column>
						<div
							style="text-align: center; margin: 15px; padding: 20px; border: 2px solid #e0e0e0; border-radius: 12px; background: #fafafa; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
							<h3
								style="color: #2c3e50; margin: 0 0 10px 0; font-size: 18px; font-weight: bold;">#{libro.titulo}</h3>

							<h:graphicImage value="#{libro.coverUrl}" width="160"
								height="220"
								style="border-radius: 8px; margin: 15px 0; border: 1px solid #ddd;"
								alt="Portada de #{libro.titulo}" />

							<div style="margin: 15px 0;">
								<p
									style="font-weight: bold; color: #34495e; margin: 5px 0; font-size: 14px;">
									Autor: #{libro.autor}</p>

								<p
									style="font-size: 12px; color: #7f8c8d; margin: 10px 0; line-height: 1.4; max-height: 60px; overflow: hidden; text-overflow: ellipsis;">
									#{libro.descripcion}</p>
							</div>

							<div style="margin-top: 20px;">
								<p:commandButton value="Descargar PDF" icon="pi pi-download"
									onclick="window.open('#{libro.bookUrl}','_blank'); return false;"
									styleClass="ui-button-info ui-button-sm"
									style="margin: 3px; padding: 8px 15px; width: 140px;" />

								<p:commandButton value="Ver Online" icon="pi pi-eye"
									onclick="window.open('#{libro.onlineUrl}','_blank'); return false;"
									styleClass="ui-button-success ui-button-sm"
									style="margin: 3px; padding: 8px 15px; width: 140px;" />

								<p:commandButton value="Eliminar" icon="pi pi-trash"
									rendered="#{!libroBean.esEstudiante()}"
									styleClass="ui-button-danger ui-button-sm"
									action="#{libroBean.eliminarPorId(libro.id)}"
									update="formLibro growl"
									onclick="return confirm('Eliminar el libro #{libro.titulo}?');"
									style="margin: 3px; padding: 8px 15px; width: 140px;" />
							</div>
						</div>
					</p:column>
				</p:dataList>
			</div>
		</h:form>

		<p:dialog widgetVar="aniadirLibro" header="Agregar nuevo libro"
			width="550" height="650" modal="true" resizable="false"
			closable="true" styleClass="my-container">

			<h:form id="formNuevoLibro" enctype="multipart/form-data">
				<div style="padding: 20px;">
					<h:panelGrid columns="2" cellpadding="15" style="width: 100%;">

						<p:outputLabel for="titulo" value="Titulo del libro:"
							style="font-weight: bold; color: #2c3e50;" />
						<p:inputText id="titulo" value="#{libroBean.titulo}"
							required="true" placeholder="Ingresa el titulo"
							style="width: 280px; padding: 10px; border-radius: 5px;" />

						<p:outputLabel for="author" value="Autor:"
							style="font-weight: bold; color: #2c3e50;" />
						<p:inputText id="author" value="#{libroBean.author}"
							required="true" placeholder="Nombre del autor"
							style="width: 280px; padding: 10px; border-radius: 5px;" />

						<p:outputLabel for="description" value="Descripcion:"
							style="font-weight: bold; color: #2c3e50;" />
						<h:inputTextarea id="description" value="#{libroBean.description}"
							rows="4" cols="35"
							style="width: 280px; height: 100px; padding: 10px; border-radius: 5px; resize: vertical;"
							placeholder="Describe el contenido del libro..." />

						<p:outputLabel for="linkVirtual" value="Link virtual (opcional):"
							style="font-weight: bold; color: #2c3e50;" />
						<p:inputText id="linkVirtual" value="#{libroBean.linkVirtual}"
							placeholder="https://ejemplo.com/libro-online"
							style="width: 280px; padding: 10px; border-radius: 5px;" />

						<p:outputLabel for="coverFile" value="Portada (imagen):"
							style="font-weight: bold; color: #2c3e50;" />
						<p:fileUpload id="coverFile" mode="simple"
							value="#{libroBean.coverFile}" style="width: 280px;"
							accept=".jpg,.jpeg,.png,.gif" />

						<p:outputLabel for="bookFile" value="Archivo PDF:"
							style="font-weight: bold; color: #2c3e50;" />
						<p:fileUpload id="bookFile" mode="simple"
							value="#{libroBean.bookFile}" style="width: 280px;" accept=".pdf" />
					</h:panelGrid>

					<p:separator style="margin: 20px 0;" />

					<div style="text-align: center; padding-top: 15px;">
						<p:commandButton value="Agregar Libro" icon="pi pi-plus"
							action="#{libroBean.addBook}"
							update="formLibro formNuevoLibro growl"
							oncomplete="PF('aniadirLibro').hide();"
							styleClass="ui-button-success"
							style="margin-right: 15px; padding: 12px 25px; font-size: 14px;" />

						<p:commandButton value="Cancelar" icon="pi pi-times" type="button"
							onclick="PF('aniadirLibro').hide();"
							styleClass="ui-button-secondary"
							style="padding: 12px 25px; font-size: 14px;" />
					</div>
				</div>
			</h:form>
		</p:dialog>

	</ui:define>
</ui:composition>
